<script defer>
  try {
    var miUrlUniversal = '';

    var botones = document.querySelectorAll('.btn-main');
    var droplistClientes = document.querySelectorAll('.cliente-array');
    var droplistEmpleados = document.querySelectorAll('.empleado-array');
    var droplistVendedores = document.querySelectorAll('.vendedor-array');
    var droplistEventos = document.querySelectorAll('.evento-array');
    var droplistProgramas = document.querySelectorAll('.programa-array');
    var droplistEstadoEventos = document.querySelectorAll('.estado-evento-array');
    var sectionsTables = document.querySelectorAll('.sections-tables');
    var sectionEventos = document.getElementById("evento-section");
    var spinnerTablas = document.querySelectorAll('.spinner-tabla');
    var fechaInput = document.getElementById("fechaEvento");
    var fechaPrograma = document.getElementById('fechaPrograma');
    var horaInicioInput = document.getElementById('horaInicioEvento');
    var horaFinInput = document.getElementById('horaFinEvento');
    var btnEditClient = document.getElementById('btnEditClient');
    var btnEventoLink = document.getElementById("eventoBtn");
    var camposCelular = document.querySelectorAll('.campo-celular');
    var contenedoresTablas = document.querySelectorAll('.wait-change-table');
    var dataTableInstances = [];
    var listaCelulares = [];

    

    retrieveDataSheets();  

    btnEventoLink.style.color = 'black';
    btnEventoLink.style.backgroundColor = 'yellow';

    var listaEstadosDemo = [
      'VENTA',
      'EN PROCESO',
      '90',
      'RESET',
      'RESET REPROGRAMADO'
    ];
    var listaEstadosMantenimiento = [
      'VENTA',
      '90',
      'EN PROCESO',
      'RESET',
      'RESET REPROGRAMADO'
    ];
    var listaEstadosSeguimiento = [
      'ACTIVADO',
      'EN PROCESO',
      'AGENDADO',
      'RESET',
      'RESET REPROGRAMADO',
      'ACTIVADO',
      'NO INTERESA',
      'CRP'
    ];
    
  
    sectionsTables.forEach(function(element) {
      element.style.display = 'none';
    });

    sectionEventos.style.display = 'block';


    // Agregar un evento 'change' a cada campo de entrada para detectar cambios
    horaInicioInput.addEventListener("change", function() {
        validarHoras();
    });

    horaFinInput.addEventListener("change", function() {
        validarHoras();
    });

    function validarHoras() {
        // Obtener valores de las horas de inicio y fin
        var horaInicio = horaInicioInput.value;
        var horaFin = horaFinInput.value;

        // Convertir las cadenas de tiempo en objetos de fecha para comparación
        var fechaInicio = new Date("2000-01-01T" + horaInicio + ":00");
        var fechaFin = new Date("2000-01-01T" + horaFin + ":00");

        // Comparar las horas y mostrar un mensaje de error si la hora de finalización es menor que la hora de inicio
        if (fechaFin <= fechaInicio) {

          horaFinInput.style.background="#FFC7C0";
          btnGuardarEvento.disabled = true;

        }else{
          horaFinInput.style.background="#B0FF8C";
          btnGuardarEvento.disabled = false;
        }
    }

    //------ FECHA Y HORA ACTUAL ---------------------------------------------------
    // Obtener la fecha actual en formato YYYY-MM-DD
    function obtenerFechaActual() {
      var now = new Date();
      var year = now.getFullYear();
      var month = (now.getMonth() + 1).toString().padStart(2, '0'); // El mes se cuenta desde 0
      var day = now.getDate().toString().padStart(2, '0');

      return year + "-" + month + "-" + day;
    }

    // Obtener la hora actual en formato HH:MM
    function obtenerHoraActual(adicion) {
      var now = new Date();
      var mihora = now.getHours();
      var miminuto =now.getMinutes()+1+adicion;
      var hora = mihora.toString().padStart(2, '0');
      var minutos = miminuto.toString().padStart(2, '0');
      return hora + ":" + minutos;
    }

    // -----------------------------------------------------------------------------
    // -------------- Diligenciamiento del correo ----------------------------------
    /*
    // Obtener referencia al elemento select y al elemento input
    var selectElement = document.getElementById("vendedorEvento");
    var inputElement = document.getElementById("correosEvento");

    // Agregar un evento de cambio al elemento select
    selectElement.addEventListener("change", function() {
        // Obtener el valor seleccionado del select
        var selectedValue = selectElement.value;
        
        // Separar los componentes del valor seleccionado
        var components = selectedValue.split("-");
        
        // El correo electrónico es el último componente
        var correo = components[components.length - 1];
        
        // Asignar el correo al valor del input
        inputElement.value = correo;
    });
    */
    // -----------------------------------------------------------------------------
    // Fechas del reporte de Excel de FOOTER
    var fechaInicioInput = document.getElementById("fechaReporteExcelInicio");
    var fechaFinInput = document.getElementById("fechaReporteExcelFin");

    // Agregar un event listener al elemento de fecha de inicio
    fechaInicioInput.addEventListener("change", function() {
        // Obtener la fecha seleccionada en el formato YYYY-MM-DD
        var fechaInicio = fechaInicioInput.value;
        
        // Convertir la fecha de inicio a un objeto de tipo Date
        var fechaInicioObj = new Date(fechaInicio);
        
        // Sumar 15 días a la fecha de inicio
        fechaInicioObj.setDate(fechaInicioObj.getDate() + 15);
        
        // Formatear la nueva fecha en el formato YYYY-MM-DD
        var fechaFin = fechaInicioObj.toISOString().slice(0, 10);
        
        // Establecer la nueva fecha en el elemento de fecha de fin
        fechaFinInput.value = fechaFin;
    });
    // -----------------------------------------------------------------------------
    document.getElementById("busquedaProgramaCliente").addEventListener("input", function() {
      var input, filter, select, options, i, option;
      input = document.getElementById("busquedaProgramaCliente");
      filter = input.value.toUpperCase();
      select = document.getElementById("programaCliente");
      options = select.getElementsByTagName("option");
      for (i = 0; i < options.length; i++) {
        option = options[i];
        if (option.textContent.toUpperCase().indexOf(filter) > -1) {
          option.style.display = "";
        } else {
          option.style.display = "none";
        }
      }
    });
    document.getElementById("busquedaClienteEvento").addEventListener("input", function() {
      var input, filter, select, options, i, option;
      input = document.getElementById("busquedaClienteEvento");
      filter = input.value.toUpperCase();
      select = document.getElementById("clienteEvento");
      options = select.getElementsByTagName("option");
      for (i = 0; i < options.length; i++) {
        option = options[i];
        if (option.textContent.toUpperCase().indexOf(filter) > -1) {
          option.style.display = "";
        } else {
          option.style.display = "none";
        }
      }
    });
    document.getElementById("busquedaClientePrograma").addEventListener("input", function() {
      var input, filter, select, options, i, option;
      input = document.getElementById("busquedaClientePrograma");
      filter = input.value.toUpperCase();
      select = document.getElementById("clientePrograma");
      options = select.getElementsByTagName("option");
      for (i = 0; i < options.length; i++) {
        option = options[i];
        if (option.textContent.toUpperCase().indexOf(filter) > -1) {
          option.style.display = "";
        } else {
          option.style.display = "none";
        }
      }
    });
    // ------------------------------------------------------------------------------
    // Agregar un evento 'change' a cada campo de entrada para detectar cambios
    var option_select_tipo_eventos = '';
    for (var i = listaEstadosSeguimiento.length - 1; i >= 0; i--) {
      var tipo_evento_value = listaEstadosSeguimiento[i];
      if(tipo_evento_value == 'EN PROCESO'){
        option_select_tipo_eventos += '<option value="' + tipo_evento_value + '" selected>' + tipo_evento_value + '</option>';
      }else{
        option_select_tipo_eventos += '<option value="' + tipo_evento_value + '">' + tipo_evento_value + '</option>';
      }
    }
    droplistEstadoEventos.forEach(function(select) {
      select.innerHTML = option_select_tipo_eventos;
    });
    var selectTipoEvento = document.getElementById("tipoEvento");
    var selectEstadoEvento = document.getElementById("estadoEvento");
    selectTipoEvento.addEventListener("change", function(event) {
      var option_select_tipo_eventos = '';
      var miListaTipoEventos = [];
      var valueSelect = event.target.value;
      if (valueSelect == 'DEMO'){
        miListaTipoEventos = listaEstadosDemo;
      }else if(valueSelect == 'MANTENIMIENTO'){
        miListaTipoEventos = listaEstadosMantenimiento;
      }else if(valueSelect == 'SEGUIMIENTO'){
        miListaTipoEventos = listaEstadosSeguimiento;
      }else{
        miListaTipoEventos = ['ERROR! REPORTAR','ERROR! REPORTAR'];
      }
      for (var i = miListaTipoEventos.length - 1; i >= 0; i--) {
          var tipo_evento_value = miListaTipoEventos[i];
          if(tipo_evento_value == 'EN PROCESO'){
            option_select_tipo_eventos += '<option value="' + tipo_evento_value + '" selected>' + tipo_evento_value + '</option>';
          }else{
            option_select_tipo_eventos += '<option value="' + tipo_evento_value + '">' + tipo_evento_value + '</option>';
          }
      }
      droplistEstadoEventos.forEach(function(select) {
        select.innerHTML = option_select_tipo_eventos;
      });
    });
    //--------------------------------------------------------------------------------
    var campoEstadoEventos = document.getElementById("estadoEvento");
    var campoResetMotivo = document.getElementById("resetMotivo");
    var campoResetPersona = document.getElementById("resetPersona");
    var labelCampoResetMotivo = document.getElementById("label-resetMotivo");
    var labelCampoResetPersona = document.getElementById("label-resetPersona");

    campoEstadoEventos.addEventListener('change', function(event) {
      var valueSelect = event.target.value;
      if(valueSelect == 'RESET'){
        campoResetMotivo.style.display = 'block';
        campoResetPersona.style.display = 'block';
        labelCampoResetMotivo.style.display = 'block';
        labelCampoResetPersona.style.display = 'block';
      }
      else{
        campoResetMotivo.style.display = 'none';
        campoResetPersona.style.display = 'none';
        labelCampoResetMotivo.style.display = 'none';
        labelCampoResetPersona.style.display = 'none';
      }
    });
    // ------------------------------------------------------------------------------
    // Agregar un evento 'change' a cada campo de entrada para detectar cambios
    var selectProgramaEvento = document.getElementById("programaEvento");
    var selectClienteEvento = document.getElementById("clienteEvento");
    var selectVendedorEvento = document.getElementById("vendedorEvento");
    selectClienteEvento.addEventListener("change", function(event) {
      var valueSelect = event.target.value;
      if (valueSelect != '0-NO APLICA'){
        btnEditClient.disabled = false;
        var dataCliente = valueSelect.split('-');
        var programa = dataCliente.slice(10).join("-");
        var vendedor = dataCliente.slice(5,10).join("-");
        selectProgramaEvento.value = programa;
        selectVendedorEvento.value = vendedor;
      }else{
        btnEditClient.disabled = true;
      }
    });
    // ------------------------------------------------------------------------------
    // Agregar un evento 'change' a cada campo de entrada para detectar cambios
    var selectClientePrograma = document.getElementById("clientePrograma");
    var selectVendedorPrograma = document.getElementById("vendedorPrograma");
    selectClientePrograma.addEventListener("change", function(event) {
      var valueSelect = event.target.value;
      if (valueSelect != '0-NO APLICA'){
        var dataCliente = valueSelect.split('-');
        var vendedorPrograma = dataCliente.slice(5,10).join("-");
        selectVendedorPrograma.value = vendedorPrograma;
      }
    });

    // -----------------------------------------------------------------------------
    // Agregar un evento 'change' a cada campo de entrada para detectar cambios
    var selectProgramaCliente = document.getElementById("programaCliente");
    selectProgramaCliente.addEventListener("click", function(event) {
      event.stopPropagation(); // Evita que el evento clic se propague y cierre el menú desplegable
    });
    var selectReferenteCliente = document.getElementById("contacto_referenteCliente");
    var selectVendedorCliente = document.getElementById("vendedorCliente");
    selectProgramaCliente.addEventListener("change", function(event) {
      var valueSelect = event.target.value;
      if (valueSelect != '0-NO APLICA'){
        var dataPrograma = valueSelect.split('-');
        var cliente = dataPrograma.slice(2).join("-");
        var vendedor = dataPrograma.slice(7,12).join("-");
        selectReferenteCliente.value = cliente;
        selectVendedorCliente.value = vendedor;
      }
    });
    
    // Iterar sobre cada botón para agregar un evento de clic
    botones.forEach(function(boton) {
      boton.addEventListener('click', function(event) {
        botones.forEach(function(boton) {
          if(boton.id == event.target.id){
            boton.style.color = 'black';
            boton.style.backgroundColor = 'yellow';
          }else{
            boton.style.color = '';
            boton.style.backgroundColor = '';
          }
          
        });
        
        sectionsTables.forEach(function(element) {
          element.style.display = 'none';
        });
        var buttonId = event.target.id;
        var nombreSeccion = buttonId.replace('Btn', '');
        nombreSeccion = nombreSeccion+'-section';
        var seccion = document.getElementById(nombreSeccion);
        if (seccion.style.display === 'none') {
          seccion.style.display = 'block'; // Muestra la sección
        } else {
          seccion.style.display = 'none'; // Oculta la sección
        }
      });
    });

    function loadingOnOff(btnNameGuardar,btnNameLoading){
      var btnGuardar = document.getElementById(btnNameGuardar);
      var btnLoading = document.getElementById(btnNameLoading);
      if (btnGuardar.classList.contains("d-none")) {
        btnGuardar.classList.remove("d-none");
        btnLoading.classList.add("d-none");
      } else {
        btnGuardar.classList.add("d-none");
        btnLoading.classList.remove("d-none");
      }
    }

    function loadingOnOffEdit(btnNameGuardar,btnNameLoading){
      var btnGuardar = document.getElementById(btnNameGuardar);
      var btnLoading = document.getElementById(btnNameLoading);
      if (btnGuardar.classList.contains("d-none")) {
        btnGuardar.classList.remove("d-none");
        btnLoading.classList.add("d-none");
      } else {
        btnGuardar.classList.add("d-none");
        btnLoading.classList.remove("d-none");
      }
    }

    function retrieveDataSheets(){

      contenedoresTablas.forEach(function(element) {
        if (element.classList.contains("d-none")) {
          element.classList.remove("d-none");
        } else {
          element.classList.add("d-none");
        }
      });


      spinnerTablas.forEach(function(element) {
        if (element.classList.contains("d-none")) {
          element.classList.remove("d-none");
        } else {
          element.classList.add("d-none");
        }
      });

      let objectInfo = {};
      google.script.run
      .withSuccessHandler(object => {
        objectInfo = object;
        loadTable(objectInfo);
        var btnsAgregar = document.querySelectorAll('.btn-agregar-tabla');
        // Iterar sobre cada botón para agregar un evento de clic
        btnsAgregar.forEach(function(boton) {
          boton.addEventListener('click', function(event) {
            var buttonId = event.target.id;
            var nombreTabla = buttonId.split('-')[2];
            btnAgregar(nombreTabla);
          });
        });

        contenedoresTablas.forEach(function(element) {
          if (element.classList.contains("d-none")) {
            element.classList.remove("d-none");
          } else {
            element.classList.add("d-none");
          }
        });

        spinnerTablas.forEach(function(element) {
          if (element.classList.contains("d-none")) {
            element.classList.remove("d-none");
          } else {
            element.classList.add("d-none");
          }
        });
        
      })
      .getData();
    }
    

    function loadTable(object) {
      const entities = ['cliente', 'vendedor', 'empleado', 'evento', 'programa'];
      const optionDefaults = {
          'cliente': '<option value="0-NO APLICA" selected>0-NO APLICA</option>',
          'programa': '<option value="0-NO APLICA" selected>0-NO APLICA</option>'
      };
      const droplistMap = {
          'cliente': droplistClientes,
          'vendedor': droplistVendedores,
          'empleado': droplistEmpleados,
          'evento': droplistEventos,
          'programa': droplistProgramas
      };
      const lengthThresholds = {
          'cliente': 13,
          'vendedor': 14,
          'empleado': 12,
          'evento': 18,
          'programa': 15
      };

      const options = entities.reduce((acc, key) => {
          let optionsStr = optionDefaults[key] || "";
          const arreglos = object[key]['usersInfo_' + key];

          optionsStr += arreglos.reduceRight((str, array) => {
              const threshold = lengthThresholds[key];
              if (array.length >= threshold) {
                  const value = array[threshold];
                  if(value === '1-1-LAURA-PALACIOS-3112817944'){
                    return str + `<option value="${value}" selected>${value}</option>`;
                  }
                  else
                  {
                    return str + `<option value="${value}">${value}</option>`;
                  }
              }
              return str;
          }, "");

          acc[key] = optionsStr;
          return acc;
      }, {});
      
      Object.keys(droplistMap).forEach(key => {
          droplistMap[key].forEach(select => {
              select.innerHTML = options[key];
          });
      });
      
      function capitalizeFirstLetter(string) {
          string = string.replaceAll("_", ' ');
          return string.charAt(0).toUpperCase() + string.slice(1);
      }

      var minutosInvertidosTotales = 0;

      for (const key in object) {
          
          const value = object[key];
          const headers = value['headers_' + key];
          const usersInfo = value['usersInfo_' + key];
          const tableName = '#tabla-' + key;

          if(key === 'evento'){
            // Filtrar los arreglos que en la posición 4 contengan la palabra 'SEGUIMIENTO'
            var seguimientoUsers = usersInfo.filter(function(user) {
              return user[4] === 'SEGUIMIENTO';
            });
            if(seguimientoUsers.length > 0){
              var listaFechasEventos = obtenerEventosDelDiaActual(headers,seguimientoUsers);
              minutosInvertidosTotales =  sumarDiferenciasDeFechas(listaFechasEventos);
            }
          }

          const formattedCols = headers.map(header => ({
              'title': capitalizeFirstLetter(header)
          }));
          
          formattedCols.push({ 'title': 'Acciones' });

          const fechaInicioIndex = headers.indexOf('fecha_inicio');
          const fechaFinalIndex = headers.indexOf('fecha_fin');

          const newData = usersInfo.map(row => {
            var actionsHTML;

            if (fechaInicioIndex > -1 && row[fechaInicioIndex]) {
              // Reformat the date using Moment.js
              row[fechaInicioIndex] = moment(row[fechaInicioIndex], 'MM/DD/YYYY HH:mm').format('DD [de] MMMM [de] YYYY HH:mm');
            }

            if (fechaFinalIndex > -1 && row[fechaFinalIndex]) {
              // Reformat the date using Moment.js
              row[fechaFinalIndex] = moment(row[fechaFinalIndex], 'MM/DD/YYYY HH:mm').format('DD [de] MMMM [de] YYYY HH:mm');
            }

            if (tableName.includes('evento') || tableName.includes('venta')) {
                actionsHTML = `
                  <div class="td-acciones-crud" id="id-edit-${key}-${row[0]}">
                      <i class="bi bi-pencil-square button-edit me-3" role="button" onclick="editarRegistroModal(this,nombreTabla='${key}')"></i>
                  </div>
                  <div class="spinner-border d-none text-success" id="id-loading-${key}-${row[0]}" role="status" disabled><span class="sr-only"></span></div>
                  <div id="id-delete-${key}-${row[0]}">
                      <i class="bi bi-trash3-fill" role="button" onclick="eliminarRegistroTabla(this,nombreTabla='${key}')"></i>
                  </div>
                  <div class="spinner-border d-none text-success" id="id-loading-delete-${key}-${row[0]}" role="status" disabled><span class="sr-only"></span></div>
              `;
            } else {
                actionsHTML = `
                  <div class="td-acciones-crud" id="id-edit-${key}-${row[0]}">
                      <i class="bi bi-pencil-square button-edit me-3" role="button" onclick="editarRegistroModal(this,nombreTabla='${key}')"></i>
                  </div>
                  <div class="spinner-border d-none text-success" id="id-loading-${key}-${row[0]}" role="status" disabled><span class="sr-only"></span></div>
              `;
            }
            row.push(actionsHTML);
            return row;
          });

          const tableConfig = {
              lengthMenu:[25,50],
              columns: formattedCols,
              data: newData,
              language: {
                  lengthMenu: 'Mostrar _MENU_ registros por página',
                  zeroRecords: 'Ningún registro encontrado',
                  info: 'Mostrando de _START_ a _END_ de un total de _TOTAL_ registros',
                  infoEmpty: 'Ningún registro encontrado',
                  infoFiltered: '(filtrados desde _MAX_ registros totales)',
                  loadingRecords: 'Cargando...'
              },
              responsive: true,
              stripeClasses: [],
              layout: {
                  topStart: {
                      buttons: [
                          {
                              extend: 'copy',
                              text: '<i class="bi bi-clipboard-check-fill"></i>',
                              titleAttr: 'Copiar',
                              className: 'btn btn-secondary'
                          },
                          {
                              extend: 'excel',
                              text: '<i class="bi bi-file-earmark-spreadsheet"></i>',
                              titleAttr: 'Exportar a excel',
                              className: 'btn btn-success'
                          },
                          {
                              extend: 'colvis',
                              text: 'Columnas',
                              titleAttr: 'Visibilidad de columnas',
                              className: 'btn btn-secondary'
                          }
                    ],
                  },
                  topEnd: function () {
                      let toolbar = document.createElement('div');
                      toolbar.style.marginRight = '5rem';
                      if(minutosInvertidosTotales < 100){
                        toolbar.innerHTML = '<b>Actual:</b> '+minutosInvertidosTotales+' min // <b>Meta:</b> 100 min';
                      }else{
                        toolbar.innerHTML = '<b>Actual:</b> '+minutosInvertidosTotales+' min // <b>Meta:</b> 100 min. Lo Lograste!! 😎 🎉 Felicidades 🌹 Gracias por tu compromiso.';
                      }
                      
          
                      return toolbar;
                    }
                  
              },
              
              initComplete: function () {
                this.api()
                    .columns()
                    .every(function () {
                        let column = this;
                        let title = column.header().textContent;
        
                        // Create input element
                        let input = document.createElement('input');
                        input.placeholder = title;
                        //column.header().replaceChildren(input);
                        column.header().appendChild(input);

                        let columnWidth = $(column.header()).width();
                        $(input).css('min-width', '20px').css('width', '100%');
                        

                        // Event listener for user input
                        input.addEventListener('click', function(event) {
                            event.stopPropagation();
                        });

                        input.addEventListener('keyup', () => {
                            if (column.search() !== this.value) {
                                column.search(input.value).draw();
                            }
                        });
                    });
              }
              
              
          };
          

          const additionalConfigs = {
              'empleado': {
                  columnVisibility: [1, 12]
              },
              'vendedor': {
                  columnVisibility: [1, 12, 13, 14, 15, 16]
              },
              'cliente': {
                  columnDefs: [
                      {
                          targets: 16,
                          render: data => data.split('-').slice(0, 5).join('-')
                      },
                      {
                          targets: 19,
                          render: data => data.split('-').slice(0, 7).join('-')
                      }
                  ],
                  columnVisibility: [1, 2, 3, 4, 11, 12, 13, 15, 17],
                  order: [[0, 'desc']]
              },
              'programa': {
                  columnDefs: [
                      {
                          targets: 14,
                          render: data => data.split('-').slice(0, 5).join('-')
                      }
                  ],
                  columnVisibility: [1, 2, 3, 5, 6, 7, 15, 16, 18, 19],
                  order: [[0, 'desc']]
              },
              'evento': {
                  columnDefs: [
                      {
                          targets: 17,
                          render: data => data.split('-').slice(0, 5).join('-')
                      },
                      {
                          targets: 21,
                          render: data => data.split('-').slice(0, 7).join('-')
                      }
                  ],
                  columnVisibility: [1, 2, 3, 8, 9, 10, 13, 16, 18, 19, 20, 22, 23],
                  order: [[8, 'desc']],
                  createdRow: function (row, data) {
                      const statusMap = {
                          'NO INTERESA': 'color-no-interesa',
                          'RESET REPROGRAMADO': 'color-reset-repre-rr',
                          'VENTA': 'color-venta',
                          '90': 'color-no-venta',
                          'CRP': 'color-crp',
                          'EN PROCESO': 'color-en-proceso',
                          'RESET': data[6] === 'TELE' ? 'color-reset-tele' : data[6] === 'ASESOR' ? 'color-reset-repre-rr' : ''
                      };
                      const rowClass = statusMap[data[5]] || '';
                      if (rowClass) $(row).addClass(rowClass);
                  }
              },
              'venta': {
                  columnDefs: [
                      {
                          targets: 5,
                          render: data => data.split('-').slice(0, 7).join('-')
                      }
                  ],
                  columnVisibility: [1, 6, 9, 10],
                  order: [[0, 'desc']]
              }
          };

          const config = additionalConfigs[key] || {};
          Object.assign(tableConfig, config);

          const miTable = new DataTable(tableName, tableConfig);
          dataTableInstances.push(miTable);

          // Agrega la clase 'pinta-acciones' a la última celda de cada fila después de que se haya inicializado la tabla
          miTable.on('draw.dt', function() {
            miTable.rows().every(function() {
                var row = this.node();
                $(row).find('td:last').addClass('pinta-acciones');
            });
          });
          
          miTable.rows().every(function() {
              var row = this.node();
              $(row).find('td:last').addClass('pinta-acciones');
          });

          if (config.columnVisibility) {
              config.columnVisibility.forEach(index => miTable.column(index).visible(false));
          }
      }

      const listaNombreTablas = ['empleado', 'vendedor', 'cliente', 'evento', 'programa', 'venta'];

      listaNombreTablas.forEach(nombreTabla => {
          const elementNombreTabla = `[aria-controls="tabla-${nombreTabla}"]`;
          const botonesDt = document.querySelectorAll(elementNombreTabla);
          if (botonesDt.length > 0) {
              const padreComun = botonesDt[0].parentNode;
              if (padreComun !== null) {
                  const botonAgregar = document.createElement('button');
                  botonAgregar.textContent = '+ Add';
                  botonAgregar.className = 'btn btn-agregar-tabla btn-warning buttons-html5';
                  botonAgregar.id = 'btn-agregar-' + nombreTabla;
                  botonAgregar.setAttribute('data-bs-toggle', 'modal');
                  const nombreModal = '#createModal' + nombreTabla.charAt(0).toUpperCase() + nombreTabla.slice(1);
                  botonAgregar.setAttribute('data-bs-target', nombreModal);
                  botonAgregar.onclick = () => btnAgregar(nombreTabla);
                  padreComun.appendChild(botonAgregar.cloneNode(true));
              }
          }
      });

    /*
    var accionesBtns = document.querySelectorAll('.td-acciones-crud');
    // Recorre cada elemento y cambia el estilo de su elemento padre
      accionesBtns.forEach(elemento => {
          const padre = elemento.parentElement;
          if (padre) {
              padre.style.display = 'flex';
              padre.style.fontSize = '2rem';
              padre.style.justifyContent = 'space-evenly';
          }
      });
      */
    }
    


    // Función para enviar el formulario de empleado
    function enviarFormEmpleado() {
      loadingOnOff('btnGuardarEmpleado','btnLoadingEmpleado');
      const form = document.getElementById('id-form-crear-empleado');
      const idEmpleado = form.idEmpleado.value;
      if(idEmpleado === '0'){
        google.script.run
        .withSuccessHandler(result => {
          console.log(result);
          if(result.includes('celular')){
            alert("No se puede crear el registro porque ya existe un usuario con el número " + String(form.celularEmpleado));
            loadingOnOff('btnGuardarEmpleado','btnLoadingEmpleado');
          }
          else{
            loadingOnOff('btnGuardarEmpleado','btnLoadingEmpleado');
            form.reset();
            actualizarTablaGrafica('#createModalEmpleado');
          }
          
        })
        .withFailureHandler(error => {
          // Manejo de la excepción
          console.error("Se ha producido un error en la función de los colaboradores: ", error);
          // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
          alert("Se ha producido un error en la función de los colaboradores: " + error.message);
        })
        .createEmpleado(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarEmpleado','btnLoadingEmpleado');
          form.reset();
          actualizarTablaGrafica('#createModalEmpleado');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los colaboradores: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los colaboradores: " + error.message);
      })
        .modifyEmpleado(form);
      }
      
    };

    // Función para enviar el formulario de vendedor
    function enviarFormVendedor() {
      loadingOnOff('btnGuardarVendedor','btnLoadingVendedor');
      const form = document.getElementById('id-form-crear-vendedor');
      const idVendedor = form.idVendedor.value;
      if(idVendedor === '0'){
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarVendedor','btnLoadingVendedor');
          form.reset();
          actualizarTablaGrafica('#createModalVendedor');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los asesores: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los asesores:  " + error.message);
      })
        .createVendedor(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarVendedor','btnLoadingVendedor');
          form.reset();
          actualizarTablaGrafica('#createModalVendedor');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los asesores: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los asesores: " + error.message);
        window.location.reload();
      })
        .modifyVendedor(form);
      }
    }

    /*
    function guardarCerrarFormCliente() {
      loadingOnOff('btnGuardarCerrarCliente','btnLoadingGuardarCerrarCliente');
      const form = document.getElementById('id-form-crear-cliente');
      const flagEditClient = document.getElementById('flag-edit-client');
      const idCliente = form.idCliente.value;
      google.script.run
      .withSuccessHandler(result => {
        console.log(result);
        if(result.includes('celular')){
          alert("No se puede crear el registro porque ya existe un usuario con el número " + String(form.celularEmpleado));
          loadingOnOff('btnGuardarCliente','btnLoadingCliente');
        }
        else{
          loadingOnOff('btnGuardarCerrarCliente','btnLoadingGuardarCerrarCliente');
          form.reset();
        }
      })
      .withFailureHandler(error => {
      // Manejo de la excepción
      console.error("Se ha producido un error en la función de los clientes: ", error);
      // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
      alert("Se ha producido un error en la función de los clientes: " + error.message);
      })
      .createCliente(form);
    }

    */

    // Función para enviar el formulario de cliente
    function enviarFormCliente() {
      loadingOnOff('btnGuardarCliente','btnLoadingCliente');
      const form = document.getElementById('id-form-crear-cliente');
      const flagEditClient = document.getElementById('flag-edit-client');
      const idCliente = form.idCliente.value;
      if(idCliente === '0'){
        google.script.run
        .withSuccessHandler(result => {
          console.log(result);
          if(result.includes('celular')){
            alert("No se puede crear el registro porque ya existe un usuario con el número " + String(form.celularEmpleado));
            loadingOnOff('btnGuardarCliente','btnLoadingCliente');
          }
          else{
            loadingOnOff('btnGuardarCliente','btnLoadingCliente');
            form.reset();
          }
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los clientes: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los clientes: " + error.message);
      })
        .createCliente(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarCliente','btnLoadingCliente');
          if(flagEditClient == 'false'){
            form.reset();
            actualizarTablaGrafica('#createModalCliente');
          }else{
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalCliente');
            createModal.hide();
          }
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los clientes: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los clientes: " + error.message);
      })
        .modifyCliente(form);
      }
    }

    // Función para enviar el formulario de programa
    function enviarFormPrograma() {
      loadingOnOff('btnGuardarPrograma','btnLoadingPrograma');
      const form = document.getElementById('id-form-crear-programa');
      const idPrograma = form.idPrograma.value;
      if(idPrograma === '0'){
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarPrograma','btnLoadingPrograma');
          form.reset();
          actualizarTablaGrafica('#createModalPrograma');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los programas: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los programas: " + error.message);
      })
        .createPrograma(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarPrograma','btnLoadingPrograma');
          form.reset();
          actualizarTablaGrafica('#createModalPrograma');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los programas: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los programas: " + error.message);
      })
        .modifyPrograma(form);
      }
    }

    // Función para enviar el formulario de Evento
    function enviarFormEvento() {
      loadingOnOff('btnGuardarEvento','btnLoadingEvento');
      const form = document.getElementById('id-form-crear-evento');
      const idEvento = form.idEvento.value;
      
      if(idEvento === '0'){
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarEvento','btnLoadingEvento');
          form.reset();
          actualizarTablaGrafica('#createModalEvento');
        })
        .withFailureHandler(error => {
          // Manejo de la excepción
          console.error("Se ha producido un error en la función de los eventos: ", error);
          // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
          alert("Se ha producido un error en la función de los eventos: " + error.message);
      })
        .createEvento(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          form.reset();
          loadingOnOff('btnGuardarEvento','btnLoadingEvento');
          actualizarTablaGrafica('#createModalEvento');
        })
        .withFailureHandler(error => {
          // Manejo de la excepción
          console.error("Se ha producido un error en la función de los eventos: ", error);
          // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
          alert("Se ha producido un error en la función de los eventos: " + error.message);
      })
        .modifyEvento(form);
      }
    }

    // Función para enviar el formulario de venta
    function enviarFormVenta() {
      loadingOnOff('btnGuardarVenta','btnLoadingVenta');
      const form = document.getElementById('id-form-crear-venta');
      const idVenta = form.idVenta.value;
      if(idVenta === '0'){
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarVenta','btnLoadingVenta');
          form.reset();
          actualizarTablaGrafica('#createModalVenta');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los ventas: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los ventas: " + error.message);
      })
        .createVenta(form);
      }
      else
      {
        google.script.run
        .withSuccessHandler(result => {
          loadingOnOff('btnGuardarVenta','btnLoadingVenta');
          form.reset();
          actualizarTablaGrafica('#createModalVenta');
        })
        .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de los ventas: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de los ventas: " + error.message);
      })
        .modifyVenta(form);
      }
    }

    function actualizarTablaGrafica(nombreModal){
      for (var i = 0; i < dataTableInstances.length; i++){
        dataTableInstances[i].destroy();
      }
      dataTableInstances = [];
      retrieveDataSheets();
      const createModal = bootstrap.Modal.getOrCreateInstance(nombreModal);
      createModal.hide();
    }

    function funcionEspecialBtn(){

      loadingOnOff('btnEditClient','btnLoadingEditClient');

      var select = document.getElementById("clienteEvento");
      var valorSelect = select.value;
      var idCliente = valorSelect.split("-")[0];
      
      google.script.run
      .withSuccessHandler(dataRow => {
        var createModal;
        createModal = bootstrap.Modal.getOrCreateInstance('#createModalCliente');
        createModal.show();

        document.getElementById("idCliente").value = idCliente;
        document.getElementById("idPersonaCliente").value = dataRow[0][0];
        document.getElementById("nombreCliente").value =  dataRow[0][4];
        document.getElementById("apellidoCliente").value =  dataRow[0][5];
        document.getElementById("celularCliente").value = dataRow[0][6];
        document.getElementById("departamentoCliente").value = dataRow[0][7];
        document.getElementById("ciudadCliente").value = dataRow[0][8];
        document.getElementById("direccionCliente").value = dataRow[0][9];
        document.getElementById("emailCliente").value = dataRow[0][10];
        if(dataRow[0][11]=="on"){
          document.getElementById("activoCliente").checked = true;
        }
        else{
          document.getElementById("activoCliente").checked = false;
        }
        document.getElementById("vendedorCliente").value = dataRow[0][13];
        document.getElementById("empleadoCliente").value = dataRow[0][14];
        document.getElementById("contacto_referenteCliente").value = dataRow[0][15];
        document.getElementById("origenCliente").value = dataRow[0][17];
        document.getElementById("programaCliente").value = dataRow[0][18];
        document.getElementById("nucleoCliente").value = dataRow[0][19];
        document.getElementById("prospectoCliente").value = dataRow[0][20];
        document.getElementById('flag-edit-client').value = 'true';

        loadingOnOff('btnEditClient','btnLoadingEditClient');
      })
      .getDataRow(idCliente,'cliente');
    }

    function seleccionarOpcion(selectId, optionValue) {
      var select = document.getElementById(selectId);
      for (var i = 0; i < select.options.length; i++) {
          if (select.options[i].value === optionValue) {
              select.selectedIndex = i;
              // Disparar el evento change para simular la acción del usuario
              var event = new Event('change', {
                  bubbles: true,
                  cancelable: true
              });
              select.dispatchEvent(event);
              break;
          }
      }
  }

    // Editar registros
    function editarRegistroModal(button, nombreTabla){

      document.getElementById('flag-edit-client').value = 'false';

      const tableRow = button.parentNode.parentNode.parentNode;
      var id = tableRow.cells[0].innerHTML;
      var dataRow;
      loadingOnOffEdit('id-edit-'+nombreTabla+'-'+id,'id-loading-'+nombreTabla+'-'+id);

      google.script.run
      .withSuccessHandler(dataRow => {
        var createModal;
      
        switch (nombreTabla) {
          case 'empleado':
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalEmpleado');
            createModal.show();

            document.getElementById("idEmpleado").value = id;
            document.getElementById("idPersonaEmpleado").value = dataRow[0][0];
            document.getElementById("nombreEmpleado").value =  dataRow[0][1];
            document.getElementById("apellidoEmpleado").value =  dataRow[0][2];
            document.getElementById("celularEmpleado").value = dataRow[0][3];
            document.getElementById("departamentoEmpleado").value = dataRow[0][4];
            document.getElementById("ciudadEmpleado").value = dataRow[0][5];
            document.getElementById("direccionEmpleado").value = dataRow[0][6];
            document.getElementById("emailEmpleado").value = dataRow[0][7];
            document.getElementById("salarioEmpleado").value = dataRow[0][8];
            document.getElementById("epsEmpleado").value = dataRow[0][9];
            document.getElementById("cargoEmpleado").value = dataRow[0][10];

            break;

          case 'vendedor':
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalVendedor');
            createModal.show();

            document.getElementById("idVendedor").value = id;
            document.getElementById("idPersonaVendedor").value = dataRow[0][0];
            document.getElementById("nombreVendedor").value =  dataRow[0][1];
            document.getElementById("apellidoVendedor").value =  dataRow[0][2];
            document.getElementById("celularVendedor").value = dataRow[0][3];
            document.getElementById("departamentoVendedor").value = dataRow[0][4];
            document.getElementById("ciudadVendedor").value = dataRow[0][5];
            document.getElementById("direccionVendedor").value = dataRow[0][6];
            document.getElementById("emailVendedor").value = dataRow[0][7];
            document.getElementById("epsVendedor").value = dataRow[0][8];
            document.getElementById("metaVendedor").value = dataRow[0][10];
            document.getElementById("idCalendarDemos").value = dataRow[0][14];
            document.getElementById("idCalendarProgramas").value = dataRow[0][15];
            if(dataRow[0][16]=="on"){
              document.getElementById("activoVendedor").checked = true;
            }
            else{
              document.getElementById("activoVendedor").checked = false;
            }
            break;

          case 'cliente':
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalCliente');
            createModal.show();

            document.getElementById("idCliente").value = id;
            document.getElementById("idPersonaCliente").value = dataRow[0][0];
            document.getElementById("nombreCliente").value =  dataRow[0][4];
            document.getElementById("apellidoCliente").value =  dataRow[0][5];
            document.getElementById("celularCliente").value = dataRow[0][6];
            document.getElementById("departamentoCliente").value = dataRow[0][7];
            document.getElementById("ciudadCliente").value = dataRow[0][8];
            document.getElementById("direccionCliente").value = dataRow[0][9];
            document.getElementById("emailCliente").value = dataRow[0][10];
            if(dataRow[0][11]=="on"){
              document.getElementById("activoCliente").checked = true;
            }
            else{
              document.getElementById("activoCliente").checked = false;
            }
            document.getElementById("vendedorCliente").value = dataRow[0][13];
            document.getElementById("empleadoCliente").value = dataRow[0][14];
            document.getElementById("contacto_referenteCliente").value = dataRow[0][15];
            document.getElementById("origenCliente").value = dataRow[0][17];
            document.getElementById("programaCliente").value = dataRow[0][18];
            document.getElementById("nucleoCliente").value = dataRow[0][19];
            document.getElementById("prospectoCliente").value = dataRow[0][20];
            document.getElementById('flag-edit-client').value = 'false';
            break;

          case 'programa':
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalPrograma');
            createModal.show();
            document.getElementById("idPrograma").value = id;
            document.getElementById("fechaPrograma").value = dataRow[0][3];
            document.getElementById("clientePrograma").value = dataRow[0][13];
            document.getElementById("vendedorPrograma").value = dataRow[0][16];
            document.getElementById("premioPrograma").value = dataRow[0][8];
            document.getElementById("resultadoPrograma").value = dataRow[0][10];
            break;

          case 'evento':

            createModal = bootstrap.Modal.getOrCreateInstance('#createModalEvento');
            createModal.show();

            document.getElementById("idEvento").value = id;
            //document.getElementById("tipoEvento").value = dataRow[0][3];
            seleccionarOpcion('tipoEvento', dataRow[0][3]);
            document.getElementById("estadoEvento").value = dataRow[0][4];
            document.getElementById("resetPersona").value = dataRow[0][5];
            document.getElementById("resetMotivo").value = dataRow[0][6];
            document.getElementById("fechaEvento").value =  dataRow[0][7];
            document.getElementById("horaInicioEvento").value =  dataRow[0][8];
            document.getElementById("horaFinEvento").value = dataRow[0][9];
            document.getElementById("correosEvento").value =  dataRow[0][12];
            document.getElementById("observacionesEvento").value = dataRow[0][13];
            document.getElementById("vendedorEvento").value = dataRow[0][14];
            document.getElementById("empleadoEvento").value = dataRow[0][15];
            document.getElementById("clienteEvento").value = dataRow[0][16];
            document.getElementById("programaEvento").value = dataRow[0][20];
            break;
          
          case 'venta':
            createModal = bootstrap.Modal.getOrCreateInstance('#createModalVenta');
            createModal.show();

            document.getElementById("idVenta").value = id;
            document.getElementById("idEventoVenta").value = dataRow[0][0];
            document.getElementById("articuloVenta").value =  dataRow[0][1];
            document.getElementById("valorVenta").value =  dataRow[0][2];
            document.getElementById("modoPagoVenta").value = dataRow[0][3];
            document.getElementById("eventoVenta").value = dataRow[0][4];
            break;

          default:
            break;
        }
        loadingOnOffEdit('id-edit-'+nombreTabla+'-'+id,'id-loading-'+nombreTabla+'-'+id);

      })
      .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función editarRegistroModal cuando se edita un registro: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función editarRegistroModal cuando se edita un registro: " + error.message);
      })
      .getDataRow(id, nombreTabla);
      
    }

  
    function eliminarRegistroTabla(button, nombreTabla){

      tableRow = button.parentNode.parentNode.parentNode;
      var id = tableRow.cells[0].innerHTML;

      const borrarBoton = document.getElementById('btnEliminarRegistro');
      const createModal = bootstrap.Modal.getOrCreateInstance('#createModalEliminar');
      createModal.show();

      document.getElementById("idBorrar").value = id;
      if(nombreTabla === 'evento'){
        document.getElementById("nombreTablaBorrar").value = 'SEGUIMIENTOS';
      }else if(nombreTabla === 'vendedor'){
        document.getElementById("nombreTablaBorrar").value = 'ASESORES';
      }
      else{
        document.getElementById("nombreTablaBorrar").value = nombreTabla.toUpperCase();
      }
      /*
      google.script.run
      .withSuccessHandler(dataRow => {
        
        loadingOnOffEdit('id-delete-'+nombreTabla+'-'+id,'id-loading-delete-'+nombreTabla+'-'+id);

      })
      .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función editarRegistroModal cuando se edita un registro: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función editarRegistroModal cuando se edita un registro: " + error.message);
      })
      .otracosa(id, nombreTabla);
      */
    }

    function deleteRow(){
      
      const form = document.getElementById('id-form-eliminar-registro');
      var id = form.idBorrar.value;
      var nombreTabla = form.nombreTablaBorrar.value;

      if(nombreTabla === 'SEGUIMIENTOS'){
        nombreTabla = 'evento';
      }else if(nombreTabla === 'ASESORES'){
        nombreTabla = 'vendedor';
      }
      else{
        nombreTabla = nombreTabla.toLowerCase();
      }


      loadingOnOffEdit('btnEliminarRegistro','btnLoadingEliminar');
      
      google.script.run
      .withSuccessHandler(result => {
        loadingOnOffEdit('btnEliminarRegistro','btnLoadingEliminar');
        form.reset();
        window.location.reload();
      })
      .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error en la función de eliminar registros: ", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error en la función de eliminar registros: " + error.message);
      })
      .borrarRegistro(id, nombreTabla);
      
    }

    function generarReporteExcel(){
      loadingOnOff('id-btn-reporte-excel','id-btn-reporte-excel-loading');
      let elementFechaReporteExcelInicio = document.getElementById('fechaReporteExcelInicio');
      let elementFechaReporteExcelFin = document.getElementById('fechaReporteExcelFin');
      var fechaReporteExcelInicio = elementFechaReporteExcelInicio.value;
      var fechaReporteExcelFin = elementFechaReporteExcelFin.value;
      google.script.run
      .withSuccessHandler(result => {
        loadingOnOff('id-btn-reporte-excel','id-btn-reporte-excel-loading');
        //window.location.reload();
      })
      .withFailureHandler(error => {
        // Manejo de la excepción
        console.error("Se ha producido un error al generar el reporte:", error);
        // Aquí puedes mostrar un mensaje de error al usuario, por ejemplo:
        alert("Se ha producido un error al generar el reporte: " + error.message);
      })
      .generarReporte(fechaReporteExcelInicio,fechaReporteExcelFin);
    }

    // Función para boton Agregar
    function btnAgregar(nombreTabla) {
      const formName = 'id-form-crear-'+nombreTabla;
      const form = document.getElementById(formName);
      form.reset();
      fechaPrograma.value = obtenerFechaActual();
      fechaInput.value = obtenerFechaActual();
      horaInicioInput.value = obtenerHoraActual(0);
      horaFinInput.value = obtenerHoraActual(2);
    };

    function obtenerEventosDelDiaActual(headers,data) {

      const fechaInicioIndex = headers.indexOf('fecha_inicio');
      const fechaFinIndex = headers.indexOf('fecha_fin');

      // Obtener la fecha actual en formato MM/DD/YYYY
      const hoy = new Date();
      const mes = ('0' + (hoy.getMonth() + 1)).slice(-2);
      const dia = ('0' + hoy.getDate()).slice(-2);
      const anio = hoy.getFullYear();
      const fechaActual = mes + '/' + dia + '/' + anio;

      // Filtrar y mapear los datos a un array de objetos
      const eventos = data.slice(1).filter(row => {
        const fechaInicio = new Date(row[fechaInicioIndex]);
        const fechaInicioStr = (fechaInicio.getMonth() + 1).toString().padStart(2, '0') + '/' +
                              fechaInicio.getDate().toString().padStart(2, '0') + '/' +
                              fechaInicio.getFullYear();
        return fechaInicioStr === fechaActual;
      }).map(row => {
        return {
          fecha_inicio: row[fechaInicioIndex],
          fecha_fin: row[fechaFinIndex]
        };
      });

      return eventos;
    }


    function sumarDiferenciasDeFechas(eventos) {

      // Obtener la fecha actual en el formato MM/DD/YYYY
      var hoy = new Date();
      var mes = ('0' + (hoy.getMonth() + 1)).slice(-2);
      var dia = ('0' + hoy.getDate()).slice(-2);
      var anio = hoy.getFullYear();
      var fechaActual = mes + '/' + dia + '/' + anio;

      // Filtrar eventos con la fecha del día actual
      var eventosFiltrados = eventos.filter(function(evento) {
        var fechaInicio = new Date(evento.fecha_inicio);
        var fechaFin = new Date(evento.fecha_fin);
        var fechaInicioStr = (fechaInicio.getMonth() + 1).toString().padStart(2, '0') + '/' +
                            fechaInicio.getDate().toString().padStart(2, '0') + '/' +
                            fechaInicio.getFullYear();
        return fechaInicioStr === fechaActual;
      });

      // Calcular la sumatoria de las diferencias en minutos
      var totalMinutos = eventosFiltrados.reduce(function(suma, evento) {
        var fechaInicio = new Date(evento.fecha_inicio);
        var fechaFin = new Date(evento.fecha_fin);
        var diferenciaMinutos = (fechaFin - fechaInicio) / (1000 * 60);
        return suma + diferenciaMinutos;
      }, 0);

      return totalMinutos;
    }

  } catch (error) {
    // Manejo de la excepción
    alert("Se ha producido un error: " + error.message);
  }

</script>
